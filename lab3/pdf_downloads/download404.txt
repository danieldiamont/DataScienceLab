Supplementary Material for Bayesian models of Data Streams with HPPs

Andrés Masegosa 1 2 Thomas D. Nielsen 3 Helge Langseth 2 Darı́o Ramos-López 1 Antonio Salmerón 1
Anders L. Madsen 3 4

A. Proof of Theorem 1 and Lemma 2

and thereby

Proof of Theorem 1. In the specification of L we have that
Eq [ln p̂(β t |λt−1 , ρt )] (defined in Equation (7)) can be expanded as (ignoring the base measure) :

∇ωt L̂ = ∇2ωt ag (ωt )(Eq [ln(pδ (β t |λt−1 ))−ln pu (β t )]+γ−ωt ).

Eq [(ρt λt−1 +(1−ρt )αu )t(β t )−ag (ρt λt−1 +(1−ρt )αu )].
Since ag is convex we have
ag (ρt λt−1 +(1−ρt )αu ) ≤ ρt ag (λt−1 )+(1−ρt )ag (αu ),
which combined with Equation (10) gives
Eq [ln p(xt , Z t |β t )] + Eq [(ρt λt−1 + (1 − ρt )αu )t(β t )
− ρt ag (λt−1 ) − (1 − ρt )ag (αu )] + Eq [p(ρt |γ)]
− Eq [ln q(Z t |φt )] − Eq [q(β t |λt )] − Eq [q(ρt |ωt )] ≤ L.
Lastly, by exploiting the mean field factorization of q and
using the exponential family form of pδ (β t |λt−1 ) and
pu (β t ) we get the desired result.

Proof of Lemma 2. Firstly, by ignoring the terms in L̂
(Equation (11)) that do not involve ωt we get
L̂(ωt ) = Eq [ρt ](Eq [ln(pδ (β t |λt−1 )) − Eq [ln pu (β t )])
+ Eq [p(ρt |γ)] − Eq [q(ρt |ωt )].
Assuming that the sufficient statistics function t(ρt ) for
p(ρt |γ) and q(β t |λt ) is the identity function (t(ρt ) = ρt )
we have

We can now find the natural gradient by premultiplying
∇ωt L̂ by the inverse of the Fisher information matrix,
which for the exponential family corresponds to the inverse
of the Hessian of the log-normalizer:
ˆ ω L̂ = (∇2ω ag (ωt ))−1 ∇ω L̂
∇
t
t
t
= Eq [ln(pδ (β t |λt−1 )) − ln pu (β t )] + γ − ωt .
Lastly, by introducing q(β t |λt ) − q(β t |λt )
side the expectation we get the difference
Kullbach-Leibler divergence KL(q(β t |λt ), pu (β t ))
KL(q(β t |λt ), pδ (β t |λt−1 )).

B. Experimental Evaluation
B.1. Probabilistic Models
We provide a (simplified) graphical description of the probabilistic models used in the experiments. We also detail
the distributional assumptions of the parameters, which are
then used to define the variational approximation family.
E LECTRICITY M ODEL
x1,t

x2,t

x3,t

L̂(ωt ) = Eq [ρt ](Eq [ln(pδ (β t |λt−1 )) − Eq [ln pu (β t )])
+ γEq [ρt ] − (ωt Eq [ρt ] − ag (ωt )) + cte.
Using Eq [t(ρt )] = Eq [ρt ] = ∇ωt ag (ωt ) we get

yt

L̂(ωt ) = ∇ωt ag (ωt )(Eq [ln(pδ (β t |λt−1 )) − Eq [ln pu (β t )])
+ γ∇ωt ag (ωt ) − (ωt ∇ωt ag (ωt ) − ag (ωt )).
1
Department of Mathematics, Unversity of Almerı́a, Almerı́a,
Spain 2 Department of Computer and Information Science, Norwegian University of Science and Technology, Trondheim, Norway 3 Department of Computer Science, Aalborg University, Aalborg, Denmark 4 Hugin Expert A/S, Aalborg, Denmark. Correspondence to: Andrés Masegosa <andresmasegosa@ual.es>.

Proceedings of the 34 th International Conference on Machine
Learning, Sydney, Australia, PMLR 70, 2017. Copyright 2017
by the author(s).

inin
−


(µi , γi ) ∼ N ormalGamma(1, 1, 0, 1e − 10)
γ ∼ Gamma(1, 1)
bi ∼ N (0, +∞)
xi,t ∼ N (µi , γi )
!
yt ∼ N

b0 +

X
i

bi xi,t , γ

Supplementary Material for Bayesian Models of Data Streams with HPPs

the SVB method. Here, we provides the plots of the absolute values of the T M LLt series for the different methods
studied in the paper.

Day t

zt

Electricity
−30

yt

−50

−40

xt

SVB
SVB−HPP
SVB−MHPP
SVB−PP−0.9

p ∼ Dirichlet(1, . . . , 1)
pk ∼ Dirichlet(1, . . . , 1)
(x)

(x)

(y)

(y)

−70

−60

GPS M ODEL

0

10

(µj,k , γj,k ) ∼ N ormalGamma(1, 1, 0, 1e − 10)

(x)

(x)

(y)

(y)

−1
−3

(xt |zt = j, Dayt = k) ∼ N (µj,k , γj,k )

GPS

−2

Dayt ∼ M ultinomial(p)

SVB
PVB−|xt|−0.1
SVB−HPP
SVB−MHPP
SVB−PP−0.9

−4

(yt |zt = j, Dayt = k) ∼ N (µj,k , γj,k )

−5

F INANCIAL M ODEL

30

Figure 2. Electricity

(µj,k , γj,k ) ∼ N ormalGamma(1, 1, 0, 1e − 10)
(zt |Dayt = k) ∼ M ultinomial(pk )

20

0

10

20

Def aultt

Figure 3. GPS
Finance

x3,t

−25

x2,t

x1,t

SVB
PVB−|xt|−0.1

−30

−20

zt

SVB−HPP
SVB−MHPP
SVB−PP−0.9

Figure 1. Simplified DAG for the financial model
0

p ∼ Dirichlet(1, . . . , 1)
pk ∼ Dirichlet(1, . . . , 1)
(µi;j,k , γi;j,k ) ∼ N ormalGamma(1, 1, 0, 1e − 10)
Def aultt ∼ Binomial(p)
(zt |Def aultt = k) ∼ M ultinomial(pk )
(xi,t |zt = j, Dayt = k) ∼ N (µi;j,k , γi;j,k )
B.2. Real Life Data Sets
In the experimental section of the original paper, we plot
the relative values for the T M LLt measure with respect to

10

20

30

40

Figure 4. Finance

50

60

